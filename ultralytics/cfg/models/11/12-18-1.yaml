# ç›®æ ‡: æ¦¨å¹² 10 GFLOPs é¢„ç®—ï¼Œæ­»ç£•å°ç›®æ ‡
# æ‰‹æ®µ: åœ¨ P2 (Detail Branch) å¢žåŠ  C3k2 æ¨¡å—ï¼Œå¹¶åœ¨èžåˆåŽå¢žåŠ æ··åˆå±‚

# Parameters
nc: 10
scales: 
  n: [0.50, 0.25, 1024] 

# Backbone (å…¨å‘˜ C3k2ï¼Œæ— é˜‰å‰²)
backbone:
  - [-1, 1, Conv, [64, 3, 2]] # 0
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4 (Detail Start)
  - [-1, 2, C3k2, [256, False, 0.25]] # 2-P3/8
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]] # 4-P4/16
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 2, C3k2, [512, True]] # 6-P5/32
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 2, C3k2, [1024, True]] # 8-P5/32
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# Head
head:
  # === UpSample P5 -> P4 ===
  - [-1, 1, DySample, [2, 'lp']] # 11
  - [[-1, 6], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 13 

  # === UpSample P4 -> P3 ===
  - [-1, 1, DySample, [2, 'lp']] # 14
  - [[-1, 4], 1, Concat, [1]] 
  - [-1, 2, C3k2, [256, False]] # 16 (P3 Main)

  # === ðŸ”¥ ULTRA Detail Branch (ç®—åŠ›ç‡ƒçƒ§åŒº) ===
  # 1. æå– P2 ç‰¹å¾ï¼ŒRepConv è°ƒæ•´é€šé“
  - [1, 1, RepConv, [128, 3, 1]] # 17
  
  # 2. ðŸ”¥ æ–°å¢ž: åœ¨é«˜åˆ†è¾¨çŽ‡(160x160)ä¸Šè·‘ C3k2
  # è¿™æ˜¯æ¶¨ GFLOPs çš„æ ¸å¿ƒï¼Œèƒ½æžå¤§åœ°æå–å°ç›®æ ‡çº¹ç†
  - [-1, 1, C3k2, [128, False, 0.25]] # 18 
  
  # 3. SimAM æ³¨æ„åŠ›
  - [-1, 1, SimAM, [128]] # 19
  
  # 4. ä¸‹é‡‡æ ·
  - [-1, 1, RepConv, [128, 3, 2]] # 20

  # === LightSDI èžåˆ ===
  # P3(256) + Detail(128) -> 256 (Add)
  - [[16, 20], 1, LightSDI, []] # 21

  # === ðŸ”¥ Post-Fusion Mixing (èžåˆåŽæ··åˆ) ===
  # èžåˆåŽåŠ ä¸€å±‚ RepConvï¼Œè®©ç‰¹å¾å……åˆ†ååº”ï¼Œé˜²æ­¢"ç”Ÿç¡¬"å åŠ 
  - [-1, 1, RepConv, [256, 3, 1]] # 22 (P3 Output)

  # === Output Path ===
  # P3 -> P4
  - [22, 1, RepConv, [256, 3, 2]] # 23 (Downsample)
  - [[-1, 13], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 25
  - [-1, 1, EMA, [512]] # 26 (P4 EMA)

  # P4 -> P5
  - [-1, 1, RepConv, [512, 3, 2]] # 27
  - [[-1, 10], 1, Concat, [1]] 
  - [-1, 2, C3k2, [1024, True]] # 29
  - [-1, 1, EMA, [1024]] # 30 (P5 EMA)

  # Detect (Input: Layer 22, 26, 30)
  - [[22, 26, 30], 1, Detect, [nc]]
