# Ultralytics YOLO ğŸš€, AGPL-3.0 License - https://ultralytics.com/license

# YOLO11n-P2-Tiny: Specialized for Small Object Detection (SODA10M)
# Outputs: P2/4 (Micro), P3/8 (Small), P4/16 (Medium)
# Removed: P5/32 (Large) - Not needed for small objects, saves parameters.
# Parameters
nc: 6  # âš ï¸ è®°å¾—æ”¹æˆä½ çš„ç±»åˆ«æ•°
scales:
  n: [0.50, 0.25, 1024]

# Backbone (å®Œå…¨ä¿æŒåŸç‰ˆï¼Œç¡®ä¿èƒ½åŠ è½½é¢„è®­ç»ƒæƒé‡)
backbone:
  # [from, repeats, module, args]
  - [-1, 1, Conv, [64, 3, 2]] # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4  <--- [Target for Micro Objects]
  - [-1, 2, C3k2, [256, False, 0.25]] # 2 (Output P2)
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]] # 4 (Output P3)
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 2, C3k2, [512, True]] # 6 (Output P4)
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32 (We will NOT use this in Head)
  - [-1, 2, C3k2, [1024, True]] # 8
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10 (Original P5 output, ignored in this config)

# head
head:
  # === Top-Down Path (FPN) ===
  # Start from P4 (Layer 6) instead of P5
  - [6, 1, nn.Upsample, [None, 2, "nearest"]] # 11: Upsample P4 -> P3 size
  - [[-1, 4], 1, Concat, [1]] # 12: Concat with Backbone P3 (Layer 4)
  - [-1, 2, C3k2, [512, False]] # 13: Feature Fusion (Neck P3)

  - [-1, 1, nn.Upsample, [None, 2, "nearest"]] # 14: Upsample P3 -> P2 size
  - [[-1, 2], 1, Concat, [1]] # 15: Concat with Backbone P2 (Layer 2)
  - [-1, 2, C3k2, [256, False]] # 16: Feature Fusion (Neck P2) -> [Detection Output 1]

  # === Bottom-Up Path (PANet) ===
  - [-1, 1, Conv, [256, 3, 2]] # 17: Downsample P2 -> P3
  - [[-1, 13], 1, Concat, [1]] # 18: Concat with Neck P3 (Layer 13)
  - [-1, 2, C3k2, [512, False]] # 19: Feature Fusion (Head P3) -> [Detection Output 2]

  - [-1, 1, Conv, [512, 3, 2]] # 20: Downsample P3 -> P4
  - [[-1, 6], 1, Concat, [1]] # 21: Concat with Backbone P4 (Layer 6)
  - [-1, 2, C3k2, [1024, True]] # 22: Feature Fusion (Head P4) -> [Detection Output 3]

  # === Detect Head ===
  # Detect on Layers: 16 (P2), 19 (P3), 22 (P4)
  - [[16, 19, 22], 1, Detect, [nc]]
