# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# FD-YOLO11 (Frequency-aware Dynamic YOLO)
# åŸºç¡€: YOLO11n + DySample (ä¿è¯ mAP å’Œå¤§ç›®æ ‡æ•ˆæœ)
# åˆ›æ–°: å¢åŠ  "High-Frequency Detail Stream" (é«˜é¢‘ç»†èŠ‚æµ)
#      åˆ©ç”¨ ScConv æ¸…æ´— P2 ç‰¹å¾ï¼Œå†ç”¨ HWD ä¸‹é‡‡æ ·èåˆåˆ° P3
#      ä¸“é—¨è§£å†³ Tricycle (ä¸‰è½®è½¦) çº¹ç†æ¨¡ç³Šé—®é¢˜

# Parameters
nc: 6 
scales: 
  n: [0.50, 0.25, 1024] 

# Backbone (æ ‡å‡†ä¸»å¹²ï¼Œä¸åŠ¨å®ƒï¼Œä¿è¯è¯­ä¹‰æå–èƒ½åŠ›)
backbone:
  # [from, repeats, module, args]
  - [-1, 1, Conv, [64, 3, 2]] # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4  <--- ç»†èŠ‚æµçš„æºå¤´
  - [-1, 2, C3k2, [256, False, 0.25]]
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]]
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 2, C3k2, [512, True]]
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 2, C3k2, [1024, True]]
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# Head (é­”æ”¹éƒ¨åˆ†)
head:
  # === æ ‡å‡†çš„ä¸Šé‡‡æ ·è·¯å¾„ (ä¿æŒ DySample) ===
  - [-1, 1, DySample, [2, 'lp']] # 11 (P5 -> P4)
  - [[-1, 6], 1, Concat, [1]] # cat backbone P4
  - [-1, 2, C3k2, [512, False]] # 13

  - [-1, 1, DySample, [2, 'lp']] # 14 (P4 -> P3)
  - [[-1, 4], 1, Concat, [1]] # cat backbone P3
  - [-1, 2, C3k2, [256, False]] # 16 (æ ‡å‡†çš„ P3 Neck è¾“å‡º)

  # === ğŸš€ [åˆ›æ–°ç‚¹] ç»†èŠ‚åˆ†æ”¯ (Detail Branch) ===
  # è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼šå›å¤´å»æ‹¿ Layer 1 (P2) çš„é«˜åˆ†è¾¨ç‡ç‰¹å¾
  
  # 17: æ¸…æ´— P2 ç‰¹å¾ (128ch -> 128ch)
  - [1, 1, ScConv, [128]] 
  
  # 18: ä¸‹é‡‡æ · (P2 -> P3 å°ºåº¦)
  # ä½¿ç”¨ HWD_Down æ—¢é™ç»´åˆä¿ç•™çº¹ç† (128ch -> 128ch)
  - [-1, 1, HWD_Down, [128]] 

  # === ğŸš€ [åˆ›æ–°ç‚¹] é¢‘ç‡é—¨æ§èåˆ ===
  # 19: èåˆ [æ ‡å‡†P3æµ(16), ç»†èŠ‚æµ(18)]
  # è¾“å…¥: 256 + 128 -> è¾“å‡º: 256
  - [[16, 18], 1, FrequencyGate, [128, 256]] # args: [c_detail, c_out]

  # === å‰©ä¸‹çš„æ£€æµ‹å¤´è·¯å¾„ (æ³¨æ„ source å˜åŒ–) ===
  
  # ä¸‹é‡‡æ · P3 -> P4
  # æ³¨æ„ï¼šè¿™é‡Œ source æ˜¯ 19 (èåˆåçš„ P3)
  - [19, 1, Conv, [256, 3, 2]] 
  - [[-1, 13], 1, Concat, [1]] # cat head P4
  - [-1, 2, C3k2, [512, False]] # 22 (P4/16-medium)

  # ä¸‹é‡‡æ · P4 -> P5
  - [-1, 1, Conv, [512, 3, 2]] 
  - [[-1, 10], 1, Concat, [1]] # cat head P5
  - [-1, 2, C3k2, [1024, True]] # 25 (P5/32-large)

  # Detect (P3 ç”¨çš„æ˜¯èåˆåçš„ 19)
  - [[19, 22, 25], 1, Detect, [nc]]