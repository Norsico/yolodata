# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# FaRFA-Rep-YOLO (Fixed for Tricycle)
# --------------------------------------------------------
# é’ˆå¯¹ 10k/640px æ•°æ®çš„æœ€ç»ˆä¿®æ­£ç‰ˆ:
# 1. ä¿ç•™ RFAConv: å®ƒè´¡çŒ®äº† Pedestrian/Car/Cyclist çš„å·¨å¤§æå‡ (+2.2% mAP)ã€‚
# 2. ç§»é™¤ HWD/SPD: å®ƒä»¬æ˜¯å¯¼è‡´ Tricycle æ‰ç‚¹çš„å…ƒå‡¶ (ç¡¬ä¸‹é‡‡æ ·ç ´åå¾®å°ç›®æ ‡)ã€‚
# 3. å¼•å…¥ RepConv ä¸‹é‡‡æ ·: åœ¨ Detail åˆ†æ”¯ä½¿ç”¨ RepConv(stride=2)ã€‚
#    è®©ç½‘ç»œ"å­¦ä¼š"å¦‚ä½•ä¿ç•™ä¸‰è½®è½¦ç‰¹å¾ï¼Œè€Œä¸æ˜¯è¢«åŠ¨è¢«åˆ‡åˆ†ã€‚
# 4. ä¿ç•™ Gate: æ—¢ç„¶å…¶ä»–ç±»åˆ«æ¶¨åˆ†äº†ï¼Œè¯´æ˜ Gate æ˜¯æœ‰æ•ˆçš„ï¼Œåªè¦è¾“å…¥ç‰¹å¾å¤Ÿå¼ºï¼ŒGate å°±èƒ½æ­£ç¡®å·¥ä½œã€‚
# --------------------------------------------------------

# Parameters
nc: 6 
scales: 
  n: [0.50, 0.25, 1024] 

# Backbone (C3k2 åŸç”Ÿæœ€ç¨³ï¼Œä¸åŠ¨)
backbone:
  - [-1, 1, Conv, [64, 3, 2]] # 0
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4 (ç»†èŠ‚æµæºå¤´)
  - [-1, 2, C3k2, [256, False, 0.25]]
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]]
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 2, C3k2, [512, True]]
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 2, C3k2, [1024, True]]
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# Head
head:
  # === DySample ä¸Šé‡‡æ · (ä¿æŒä¸åŠ¨ï¼Œæ•ˆæœå¾ˆå¥½) ===
  - [-1, 1, DySample, [2, 'lp']] # 11
  - [[-1, 6], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 13

  - [-1, 1, DySample, [2, 'lp']] # 14
  - [[-1, 4], 1, Concat, [1]] 
  - [-1, 2, C3k2, [256, False]] # 16 (P3 è¯­ä¹‰æµ)

  # === ğŸš€ [ä¿®æ­£] Detail Branch (FaRFA-Rep) ===
  # è¾“å…¥: P2 (128é€šé“, 160x160)
  
  # 17: RFAConv (128 -> 128)
  - [2, 1, RFAConv, [128]] 
  
  # 18: ğŸš€ RepConv ä¸‹é‡‡æ · (æ›¿ä»£ HWD/SPD)
  # å‚æ•°: [out_ch, kernel, stride] -> [128, 3, 2]
  # é€»è¾‘: ç”¨ RepConv æ›¿ä»£ HWDã€‚RepConv èƒ½åœ¨ä¸‹é‡‡æ ·æ—¶é€šè¿‡å¤šåˆ†æ”¯è®­ç»ƒï¼Œ
  # å¼ºè¡Œä¿ç•™ä½ä¸‰è½®è½¦çš„ç‰¹å¾å¼ºåº¦ï¼Œé˜²æ­¢è¢« Gate è¯¯æ€ã€‚
  - [-1, 1, RepConv, [128, 3, 2, 1]] # [out, k, s, p] -> å¼ºåˆ¶ p=1

  # === é¢‘ç‡é—¨æ§èåˆ ===
  # 19: ä¿æŒ FrequencyGate
  # ç°åœ¨ Layer 18 é€æ¥çš„æ˜¯ç»è¿‡ RepConv å¼ºåŒ–çš„ç‰¹å¾ï¼ŒGate åº”è¯¥èƒ½è¯†åˆ«å‡º Tricycle äº†
  - [[16, 18], 1, FrequencyGate, [128, 256]] 

  # === è¾“å‡ºè·¯å¾„ ===
  - [19, 1, Conv, [256, 3, 2]] 
  - [[-1, 13], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 22

  - [-1, 1, Conv, [512, 3, 2]] 
  - [[-1, 10], 1, Concat, [1]] 
  - [-1, 2, C3k2, [1024, True]] # 25

  - [[19, 22, 25], 1, Detect, [nc]]