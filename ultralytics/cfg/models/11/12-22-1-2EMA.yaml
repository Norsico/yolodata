# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# 12-13-2 + EMA(P4/P5 only)
# --------------------------------------------------------
# æ ¸å¿ƒï¼šP3(å°ç›®æ ‡)ä¸åŠ ä»»ä½•æ³¨æ„åŠ›ï¼›åªåœ¨ P4/P5 åŠ  EMA
# Detect è¾“å…¥ï¼šP3 ç”¨ FrequencyGate è¾“å‡º(19)ï¼ŒP4/P5 ç”¨ EMA åçš„ç‰¹å¾
# --------------------------------------------------------

nc: 6
scales:
  n: [0.50, 0.25, 1024]

backbone:
  - [-1, 1, Conv, [64, 3, 2]]                  # 0
  - [-1, 1, Conv, [128, 3, 2]]                 # 1-P2/4
  - [-1, 2, C3k2, [256, False, 0.25]]          # 2-P2/4
  - [-1, 1, Conv, [256, 3, 2]]                 # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]]          # 4
  - [-1, 1, Conv, [512, 3, 2]]                 # 5-P4/16
  - [-1, 2, C3k2, [512, True]]                 # 6
  - [-1, 1, Conv, [1024, 3, 2]]                # 7-P5/32
  - [-1, 2, C3k2, [1024, True]]                # 8
  - [-1, 1, SPPF, [1024, 5]]                   # 9
  - [-1, 2, C2PSA, [1024]]                     # 10

head:
  # === DySample ä¸Šé‡‡æ · ===
  - [-1, 1, DySample, [2, 'lp']]               # 11
  - [[-1, 6], 1, Concat, [1]]                  # 12
  - [-1, 2, C3k2, [512, False]]                # 13

  - [-1, 1, DySample, [2, 'lp']]               # 14
  - [[-1, 4], 1, Concat, [1]]                  # 15
  - [-1, 2, C3k2, [256, False]]                # 16 (P3 è¯­ä¹‰æµ)

  # === Detail Branchï¼ˆ12-13-2ï¼šæºå¤´ Layer1ï¼‰===
  - [1, 1, RFAConv, [128]]                     # 17  âœ… ä¿®æ­£ï¼šfrom=1
  - [-1, 1, Conv, [128, 3, 2]]                 # 18

  # === Gate èåˆï¼ˆå¾—åˆ°æœ€ç»ˆ P3ï¼‰===
  - [[16, 18], 1, FrequencyGate, [128, 256]]   # 19 (Fused P3)

  # === è¾“å‡ºè·¯å¾„ ===
  - [19, 1, Conv, [256, 3, 2]]                 # 20
  - [[-1, 13], 1, Concat, [1]]                 # 21
  - [-1, 2, C3k2, [512, False]]                # 22 (P4)

  - [-1, 1, Conv, [512, 3, 2]]                 # 23
  - [[-1, 10], 1, Concat, [1]]                 # 24
  - [-1, 2, C3k2, [1024, True]]                # 25 (P5)

  # === EMA åªä½œç”¨åœ¨ P4/P5ï¼ˆP3 ä¸åŠ ä»»ä½•æ³¨æ„åŠ›ï¼‰===
  - [22, 1, EMA, []]                           # 26
  - [25, 1, EMA, []]                           # 27

  - [[19, 26, 27], 1, Detect, [nc]]
