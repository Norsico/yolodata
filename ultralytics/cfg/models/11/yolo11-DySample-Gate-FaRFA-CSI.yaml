# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# FaRFA-CSI-DySample-YOLO
# --------------------------------------------------------
# æ ¸å¿ƒç­–ç•¥: 
# 1. å‰ç«¯: FaRFA + Gate (è§£å†³æéš¾ä¸‰è½®è½¦)ã€‚
# 2. åç«¯: æ‰‹å†™ CSI äº¤äº’é€»è¾‘ï¼Œå…¨éƒ¨ä½¿ç”¨ DySample è¿›è¡Œä¸Šé‡‡æ ·ã€‚
#    ç›®æ ‡: åˆ©ç”¨ DySample çš„é«˜è´¨é‡é‡å»ºï¼Œè®© P3/P4/P5 çš„ç‰¹å¾å……åˆ†èåˆï¼Œæå‡ä¸­ç­‰éš¾åº¦æ ·æœ¬å¬å›ç‡ã€‚
# --------------------------------------------------------

# Parameters
nc: 6 
scales: 
  n: [0.50, 0.25, 1024] 

# Backbone (C3k2 åŸç”Ÿæœ€ç¨³)
backbone:
  - [-1, 1, Conv, [64, 3, 2]] # 0
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4
  - [-1, 2, C3k2, [256, False, 0.25]]
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]]
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 2, C3k2, [512, True]]
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 2, C3k2, [1024, True]]
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# Head (FaRFA + Gate + CSI-DySample)
head:
  # === 1. æ ‡å‡† FPN ä¸Šé‡‡æ · (DySample) ===
  - [-1, 1, DySample, [2, 'lp']] # 11 (P5 -> P4)
  - [[-1, 6], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 13 (åŸå§‹ P4)

  - [-1, 1, DySample, [2, 'lp']] # 14 (P4 -> P3)
  - [[-1, 4], 1, Concat, [1]] 
  - [-1, 2, C3k2, [256, False]] # 16 (åŸå§‹ P3)

  # === 2. Detail Branch (FaRFA) ===
  # ä½ çš„å† å†›ç»„åˆ: RFAConv + HWD
  - [1, 1, RFAConv, [128]] # 17 (ä¿æŒ128é€šé“ï¼Œä½ è¯´æ•ˆæœå¥½)
  - [-1, 1, HWD_Down, [128]] # 18

  # === 3. Gate Fusion ===
  # P3 ä¸ Detail èåˆ
  - [[16, 18], 1, FrequencyGate, [128, 256]] # 19 (P3_Fused)

  # === 4. Neck Output Path (å¸¸è§„ä¸‹é‡‡æ ·) ===
  # P3 -> P4
  - [19, 1, Conv, [256, 3, 2]] # 20
  - [[-1, 13], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 22 (P4_Fused)

  # P4 -> P5
  - [-1, 1, Conv, [512, 3, 2]] # 23
  - [[-1, 10], 1, Concat, [1]] 
  - [-1, 2, C3k2, [1024, True]] # 25 (P5_Fused)

  # =========================================================
  # ğŸš€ [æ ¸å¿ƒæ”¹åŠ¨] CSI è·¨å°ºåº¦äº¤äº’ (æ‰‹å†™é€»è¾‘)
  # è¿™é‡Œä¸å†ç”¨ç®€å•çš„ Detect æ¥ [19, 22, 25]
  # è€Œæ˜¯è®©å®ƒä»¬å†äº¤äº’ä¸€æ¬¡ï¼
  # =========================================================

  # --- å¢å¼º P3 (Small Object) ---
  # P3_new = P3_Fused(19) + DySample(P4_Fused(22))
  # é€»è¾‘: è®©å°ç›®æ ‡çœ‹åˆ°ä¸­ç›®æ ‡çš„è¯­ä¹‰ï¼Œå‡å°‘"çœ‹ä¸å…¨"å¯¼è‡´çš„æ¼æ£€
  - [22, 1, DySample, [2, 'lp']] # 26 (P4 ä¸Šé‡‡æ ·)
  - [[19, 26], 1, Concat, [1]] # 27
  - [-1, 2, C3k2, [256, False]] # 28 (ğŸ‘‰ P3_Final)

  # --- å¢å¼º P5 (Large Object) ---
  # P5_new = P5_Fused(25) + Downsample(P4_Fused(22))
  - [22, 1, Conv, [512, 3, 2]] # 29 (P4 ä¸‹é‡‡æ ·)
  - [[25, 29], 1, Concat, [1]] # 30
  - [-1, 2, C3k2, [1024, True]] # 31 (ğŸ‘‰ P5_Final)

  # --- å¢å¼º P4 (Medium Object - 0.3~0.7 Recall å…³é”®) ---
  # P4_new = P4_Fused(22) + Down(P3_Final) + Up(P5_Final)
  # é€»è¾‘: ä¸­ç›®æ ‡æ˜¯æœ€çº ç»“çš„ï¼Œæ—¢è¦çœ‹æ¸…ç»†èŠ‚(P3)ï¼Œåˆè¦çœ‹æ‡‚ç¯å¢ƒ(P5)
  # æ‰€ä»¥æˆ‘ä»¬æŠŠåˆšæ‰å¢å¼ºè¿‡çš„ P3 å’Œ P5 éƒ½æ‹¿è¿‡æ¥å–‚ç»™å®ƒï¼
  
  - [28, 1, Conv, [256, 3, 2]] # 32 (P3_Final ä¸‹é‡‡æ ·)
  - [31, 1, DySample, [2, 'lp']] # 33 (P5_Final ä¸Šé‡‡æ ·)
  - [[22, 32, 33], 1, Concat, [1]] # 34 (ä¸‰è·¯æ±‡èš!)
  - [-1, 2, C3k2, [512, False]] # 35 (ğŸ‘‰ P4_Final)

  # Detect
  - [[28, 35, 31], 1, Detect, [nc]]