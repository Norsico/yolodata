# Ultralytics ðŸš€ AGPL-3.0 License - https://ultralytics.com/license
# 12-13-2 + Dual-P2 Detail + HFEnhance (Tricycle-friendly)

# Parameters
nc: 6
scales:
  n: [0.50, 0.25, 1024]

# Backbone (ä¿æŒä½ åŽŸå§‹ 12-13-2 ä¸å˜)
backbone:
  - [-1, 1, Conv, [64, 3, 2]]                 # 0
  - [-1, 1, Conv, [128, 3, 2]]                # 1-P2/4 (Raw)
  - [-1, 2, C3k2, [256, False, 0.25]]          # 2-P2/4 (Refined)

  - [-1, 1, Conv, [256, 3, 2]]                # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]]          # 4
  - [-1, 1, Conv, [512, 3, 2]]                # 5-P4/16
  - [-1, 2, C3k2, [512, True]]                 # 6
  - [-1, 1, Conv, [1024, 3, 2]]               # 7-P5/32
  - [-1, 2, C3k2, [1024, True]]                # 8
  - [-1, 1, SPPF, [1024, 5]]                   # 9
  - [-1, 2, C2PSA, [1024]]                     # 10

# Head (å‡çº§ç‚¹éƒ½åœ¨è¿™é‡Œ)
head:
  # === DySample ä¸Šé‡‡æ · (P5->P4) ===
  - [-1, 1, DySample, [2, 'lp']]               # 11
  - [[-1, 6], 1, Concat, [1]]                  # 12
  - [-1, 2, C3k2, [512, False]]                # 13 (P4 top-down)

  # === DySample ä¸Šé‡‡æ · (P4->P3) ===
  - [-1, 1, DySample, [2, 'lp']]               # 14
  - [[-1, 4], 1, Concat, [1]]                  # 15
  - [-1, 2, C3k2, [256, False]]                # 16 (P3 semantic)

  # ==========================================================
  # ðŸš€ Detail Branch: Dual-Source P2 (Raw + Refined) + HFEnhance
  # ==========================================================
  - [1, 1, RFAConv, [128]]                     # 17  P2 raw  -> detail
  - [2, 1, RFAConv, [128]]                     # 18  P2 refined -> detail
  - [[17, 18], 1, Concat, [1]]                 # 19  concat (dual-source)
  - [-1, 1, Conv, [128, 1, 1]]                 # 20  fuse to 128 (å®žé™…ä¼šæŒ‰ width ç¼©æ”¾)
  - [-1, 1, HFEnhance, []]                     # 21  é«˜é¢‘æ®‹å·®å¢žå¼º(é»˜è®¤k=3)

  # ä¸‹é‡‡æ ·åˆ° P3 å°ºåº¦
  - [-1, 1, Conv, [128, 3, 2]]                 # 22  P2->P3
  - [-1, 1, HFEnhance, []]                     # 23  å†å¢žå¼ºä¸€æ¬¡é«˜é¢‘(æ›´ä¿ç»†æ†/è¾¹ç¼˜)

  # === Gate èžåˆ (P3) ===
  - [[16, 23], 1, FrequencyGate, [128, 256]]   # 24  fused P3 (è¾“å‡º c_out=256)

  # === è¾“å‡ºè·¯å¾„ (PAN: P3 -> P4) ===
  - [24, 1, Conv, [256, 3, 2]]                 # 25
  - [[-1, 13], 1, Concat, [1]]                 # 26
  - [-1, 2, C3k2, [512, False]]                # 27  P4 out

  # === è¾“å‡ºè·¯å¾„ (PAN: P4 -> P5) ===
  - [-1, 1, Conv, [512, 3, 2]]                 # 28
  - [[-1, 10], 1, Concat, [1]]                 # 29
  - [-1, 2, C3k2, [1024, True]]                # 30  P5 out

  # === Detect (P3, P4, P5) ===
  - [[24, 27, 30], 1, Detect, [nc]]            # 31
