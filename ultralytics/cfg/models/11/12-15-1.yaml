# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# Hybrid-Attention-YOLO
# --------------------------------------------------------
# æ ¸å¿ƒç­–ç•¥: "åˆ†å±‚æ²»ç†"
# 1. P3å±‚ (æ£€æµ‹ä¸‰è½®è½¦): 
#    âŒ ç¦ç”¨ EMA (é¿å…å…¨å±€å¹³å‡æŠ¹æ€æå°ç›®æ ‡)ã€‚
#    âœ… ä¿æŒçº¯å‡€æˆ–ä½¿ç”¨ SimAM (ç‚¹å¯¹ç‚¹å¢å¼º)ã€‚
# 2. P4/P5å±‚ (æ£€æµ‹è¡Œäºº/éª‘è¡Œè€…): 
#    âœ… å¯ç”¨ EMA (å¢å¼ºæ¨¡ç³Šçƒ­æºç›®æ ‡çš„ç‰¹å¾èšåˆ)ã€‚
# 3. Detail Branch: é”å®š Conv ä¸‹é‡‡æ · (Tricycle 0.2295 çš„åŸºçŸ³)ã€‚
# --------------------------------------------------------

# Parameters
nc: 6 
scales: 
  n: [0.50, 0.25, 1024] 

# Backbone (C3k2 åŸç”Ÿï¼Œä¸åŠ¨)
backbone:
  - [-1, 1, Conv, [64, 3, 2]] # 0
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4 (Raw)
  - [-1, 2, C3k2, [256, False, 0.25]] # 2-P2/4 (Refined)

  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]]
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 2, C3k2, [512, True]]
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 2, C3k2, [1024, True]]
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# Head
head:
  # === DySample ä¸Šé‡‡æ · ===
  - [-1, 1, DySample, [2, 'lp']] # 11
  - [[-1, 6], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 13

  - [-1, 1, DySample, [2, 'lp']] # 14
  - [[-1, 4], 1, Concat, [1]] 
  - [-1, 2, C3k2, [256, False]] # 16 (P3 è¯­ä¹‰æµ)

  # === Detail Branch (12-13-2 çš„æ ¸å¿ƒ) ===
  # ä¿æŒä¸åŠ¨ï¼è¿™æ˜¯ 0.2295 çš„æ¥æº
  - [2, 1, RFAConv, [128]] # 17 (æºå¤´ Layer 2)
  - [-1, 1, Conv, [128, 3, 2]] # 18 (Conv ä¸‹é‡‡æ ·)

  # === Gate èåˆ ===
  - [[16, 18], 1, FrequencyGate, [128, 256]] # 19

  # === Neck Output Path ===
  - [19, 1, Conv, [256, 3, 2]] # 20
  - [[-1, 13], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 22 (P4 feat)

  - [-1, 1, Conv, [512, 3, 2]] # 23
  - [[-1, 10], 1, Concat, [1]] 
  - [-1, 2, C3k2, [1024, True]] # 25 (P5 feat)

  # ==========================================
  # ğŸš€ [æ··åˆæ³¨æ„åŠ›ç­–ç•¥] Hybrid Attention
  # ==========================================

  # å¯¹ P3 (å°ç›®æ ‡)
  # âœ… æ”¹å› [], ä»£ç ä¼šè‡ªåŠ¨è¯†åˆ«ä¸º 256 (é€ä¼ )
  - [19, 1, SimAM, []] # 26 

  # å¯¹ P4 (ä¸­ç›®æ ‡)
  # âœ… æ”¹å› [], ä»£ç ä¼šè‡ªåŠ¨è¯†åˆ«ä¸º 128 (é€ä¼ )
  - [22, 1, EMA, []] # 27 

  # å¯¹ P5 (å¤§ç›®æ ‡)
  # âœ… æ”¹å› [], ä»£ç ä¼šè‡ªåŠ¨è¯†åˆ«ä¸º 256 (é€ä¼ )
  - [25, 1, EMA, []] # 28 

  # Detect
  - [[26, 27, 28], 1, Detect, [nc]]