# =============================================================================
# YOLOv11n - HighRes Engine (Nuclear Option)
# Strategy: 
# 1. P2 High-Res Engine: Fusion & Processing at 160x160 resolution.
#    (Backbone P2 + Detail Branch) -> C3k2 (Heavy!) -> Downsample.
# 2. P3 Super Concat: Merge the processed High-Res features into P3.
# 3. DySample: Keep for stability.
# Target: Maximum Information Preservation for Tiny Objects (Tricycle).
# =============================================================================

# Parameters
nc: 6 
scales: 
  n: [0.50, 0.25, 1024] 

# Backbone (Standard)
backbone:
  - [-1, 1, Conv, [64, 3, 2]] # 0
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4 (Source A: 160x160)
  - [-1, 2, C3k2, [256, False, 0.25]] # 2
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]] # 4
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 2, C3k2, [512, True]] # 6
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 2, C3k2, [1024, True]] # 8
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# Head
head:
  # === â˜¢ï¸ High-Res Engine (é«˜åˆ†è¾¨ç‡å¤„ç†å¼•æ“) ===
  # 1. æå– Detail (160x160)
  - [1, 1, RFAConv, [128]] # 11 (160x160)
  
  # 2. ã€å…³é”®ä¸€æ­¥ã€‘P2 æ—©æœŸèåˆ
  # æŠŠ Backbone çš„ P2 (1) å’Œ Detail (11) æ‹¼èµ·æ¥
  # æ­¤æ—¶åˆ†è¾¨ç‡æ˜¯ 160x160ï¼Œä¿ç•™äº†æ‰€æœ‰ä¸‰è½®è½¦çš„ç»†èŠ‚
  - [[1, 11], 1, Concat, [1]] # 12 (128+128 = 256ch)

  # 3. ã€ç®—åŠ›é»‘æ´ã€‘åœ¨ 160x160 ä¸Šè·‘ C3k2
  # è¿™ä¸€æ­¥æå…¶æ˜‚è´µï¼Œä½†èƒ½è®©ç½‘ç»œåœ¨é™ç»´å‰å……åˆ†ç†è§£å°ç›®æ ‡
  - [-1, 2, C3k2, [256, False, 0.25]] # 13 (Processing at High Res)

  # 4. ä¸‹é‡‡æ ·å¯¹æ¥ P3
  # ç”¨ stride=2 çš„ Conv æŠŠå¤„ç†å¥½çš„ç‰¹å¾é€ä¸‹å»
  - [-1, 1, Conv, [256, 3, 2]] # 14 (Out: 80x80x256)


  # === P5 -> P4 ===
  - [10, 1, DySample, [2, 'lp']] # 15 (From SPPF)
  - [[-1, 6], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 17

  # === P4 -> P3 ===
  - [-1, 1, DySample, [2, 'lp']] # 18 (From P4)

  # === ğŸš€ Super Concat (ä¸‰è·¯æ±‡èš) ===
  # 1. P4_up (è¯­ä¹‰)
  # 2. Backbone P3 (åŸå§‹)
  # 3. HighRes_Engine Output (14) (ç»è¿‡ç²¾ç»†åŠ å·¥çš„çº¹ç†ç‰¹å¾)
  - [[-1, 4, 14], 1, Concat, [1]] # 19
  
  # P3 Head (ä¿æŒ n=2 åŠ åš)
  - [-1, 2, C3k2, [256, False, 2]] # 20 

  # === Output Path ===
  - [-1, 1, Conv, [256, 3, 2]] # 21
  - [[-1, 17], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 23

  - [-1, 1, Conv, [512, 3, 2]] # 24
  - [[-1, 10], 1, Concat, [1]] 
  - [-1, 2, C3k2, [1024, True]] # 26

  - [[20, 23, 26], 1, Detect, [nc]] # 27
