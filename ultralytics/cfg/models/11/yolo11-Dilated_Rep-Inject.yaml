# Ultralytics ðŸš€ AGPL-3.0 License - https://ultralytics.com/license

# HRC-YOLO (High-Resolution Context YOLO)
# --------------------------------------------------------
# æž¶æž„é‡æž„: åŒæµå¹¶è¡Œ (Dual-Stream)
# Stream 1: æ ‡å‡† P3/P4/P5 FPN (è´Ÿè´£å¤§ã€ä¸­ç›®æ ‡)
# Stream 2: é«˜åˆ†è¾¨çŽ‡ P2 ç‹¬ç«‹æµ (è´Ÿè´£æžå°ã€ä¸è§„åˆ™ Tricycle)
# äº¤äº’: ä½¿ç”¨ Semantic_Inject æŠŠ Stream 1 çš„ä¿¡æ¯æ³¨å…¥ Stream 2
# --------------------------------------------------------

# Parameters
nc: 6 
scales: 
  n: [0.50, 0.25, 1024] 

# Backbone (C3k2 åŽŸç”Ÿ)
backbone:
  - [-1, 1, Conv, [64, 3, 2]] # 0
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4 (High-Res Stream èµ·ç‚¹)
  - [-1, 2, C3k2, [256, False, 0.25]]
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  - [-1, 2, C3k2, [512, False, 0.25]]
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  - [-1, 2, C3k2, [512, True]]
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  - [-1, 2, C3k2, [1024, True]]
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# Head
head:
  # ==========================================
  # Stream 1: æ ‡å‡† FPN (å¤„ç†å¸¸è§„ç‰©ä½“)
  # ==========================================
  - [-1, 1, DySample, [2, 'lp']] # 11 (P5 -> P4)
  - [[-1, 6], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 13 (P4_out)

  - [-1, 1, DySample, [2, 'lp']] # 14 (P4 -> P3)
  - [[-1, 4], 1, Concat, [1]] 
  - [-1, 2, C3k2, [256, False]] # 16 (P3_out - è¯­ä¹‰æµç»ˆç‚¹)

  # ==========================================
  # Stream 2: P2 é«˜åˆ†ç‹¬ç«‹æµ (High-Res Context)
  # ä¸“é—¨å¤„ç† Tricycle å’Œ Pedestrian
  # ==========================================
  
  # 17: ä»Ž Backbone P2 (Layer 1) æ‹‰å‡ºæ¥
  # å…ˆè¿‡ä¸€ä¸ª 1x1 é™ç»´ï¼ŒæŠŠé€šé“æ•°åŽ‹åˆ° 64ï¼Œé˜²æ­¢è®¡ç®—é‡çˆ†ç‚¸
  - [1, 1, Conv, [64, 1, 1]] 
  
  # 18: Dilated_Rep (ç©ºæ´žé‡å‚æ•°åŒ–)
  # æ ¸å¿ƒ: ç”¨ d=1,2,3 çš„ç©ºæ´žå·ç§¯æ•æ‰ä¸è§„åˆ™çš„ä¸‰è½®è½¦ï¼Œä¸é™åˆ†è¾¨çŽ‡
  - [-1, 1, Dilated_Rep, [64]] 

  # 19: è¯­ä¹‰æ³¨å…¥ (Inject P3 into P2)
  # è¾“å…¥: [P2(18), P3(16)] -> [64ch, 256ch]
  # ä½œç”¨: ç”¨ P3 çš„è¯­ä¹‰å‘Šè¯‰ P2 å“ªé‡Œæœ‰è½¦
  - [[-1, 16], 1, Semantic_Inject, [64, 256]] # [c_high, c_low]

  # 20: å†æ¥ä¸€æ¬¡ Dilated_Rep å¼ºåŒ–ç‰¹å¾
  - [-1, 1, Dilated_Rep, [128]] # è¾“å‡º 128 é€šé“ï¼Œå‡†å¤‡èžåˆ

  # ==========================================
  # æœ€ç»ˆèžåˆä¸Žè¾“å‡º
  # ==========================================
  
  # ä¸‹é‡‡æ · P2_stream å›žåˆ° P3 å°ºå¯¸ï¼Œèžå…¥ä¸»åˆ†æ”¯
  # è¿™æ · Detect å¤´ä¾ç„¶æ˜¯ P3, P4, P5 ç»“æž„ï¼Œä¸éœ€è¦åŠ  P2 å¤´
  - [20, 1, Conv, [256, 3, 2]] # 21 (P2 -> P3å°ºå¯¸)
  
  # èžåˆ P3_out(16) å’Œ P2_stream(21)
  - [[16, 21], 1, Concat, [1]] # 22
  - [-1, 1, C3k2, [256, False]] # 23 (P3_Final)

  # ä¸‹é‡‡æ · P3 -> P4
  - [-1, 1, Conv, [256, 3, 2]] # 24
  - [[-1, 13], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 26 (P4_Final)

  # ä¸‹é‡‡æ · P4 -> P5
  - [-1, 1, Conv, [512, 3, 2]] # 27
  - [[-1, 10], 1, Concat, [1]] 
  - [-1, 2, C3k2, [1024, True]] # 29 (P5_Final)

  # Detect: [P3(23), P4(26), P5(29)]
  - [[23, 26, 29], 1, Detect, [nc]]