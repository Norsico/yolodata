# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license

# FD-Star-YOLO (Frequency-aware Dynamic StarNet YOLO)
# --------------------------------------------------------
# æ ¸å¿ƒç­–ç•¥: "è½»é‡åŒ–ä¸»å¹² + é«˜ç²¾åº¦åŒæµå¤´"
# 1. Backbone: å¼•å…¥ CVPR'24 StarNet (C2f_Star)ï¼Œé™ä½è®¡ç®—é‡ï¼Œæå‡ç‰¹å¾æŠ½è±¡æ•ˆç‡ã€‚
# 2. Head: ä½¿ç”¨ FD-Gate (FrequencyGate) + DySampleï¼Œç²¾å‡†èåˆé«˜é¢‘ç»†èŠ‚ä¸æ·±å±‚è¯­ä¹‰ã€‚
# --------------------------------------------------------

# Parameters
nc: 6 # SODA10M
scales: 
  n: [0.50, 0.25, 1024] 

# Backbone (ä½¿ç”¨ StarNet è¿›è¡Œé‡æ„)
backbone:
  # [from, repeats, module, args]
  - [-1, 1, Conv, [64, 3, 2]] # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]] # 1-P2/4 <--- ç»†èŠ‚æµ(Detail Stream)çš„æºå¤´
  
  # ğŸš€ [åˆ›æ–°ç‚¹ 1] ä½¿ç”¨ C2f_Star æ›¿æ¢åŸæœ¬çš„ C3k2
  # Star Operation (Element-wise Mul) åœ¨é«˜ç»´ç©ºé—´æå–ç‰¹å¾ï¼Œæ¯”æ™®é€šå·ç§¯æ›´é«˜æ•ˆ
  - [-1, 2, C2f_Star, [256, False, 0.25]] # 2
  
  - [-1, 1, Conv, [256, 3, 2]] # 3-P3/8
  
  # ğŸš€ [åˆ›æ–°ç‚¹ 1] ç»§ç»­æ›¿æ¢
  - [-1, 2, C2f_Star, [512, False, 0.25]] # 4
  
  - [-1, 1, Conv, [512, 3, 2]] # 5-P4/16
  
  # ğŸš€ [åˆ›æ–°ç‚¹ 1] ç»§ç»­æ›¿æ¢
  - [-1, 2, C2f_Star, [512, True]] # 6
  
  - [-1, 1, Conv, [1024, 3, 2]] # 7-P5/32
  
  # ğŸš€ [åˆ›æ–°ç‚¹ 1] ç»§ç»­æ›¿æ¢
  - [-1, 2, C2f_Star, [1024, True]] # 8
  
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# Head (ä¿æŒä½ æœ€å¼ºçš„ FD-Gate ç»“æ„)
head:
  # === æ ‡å‡†çš„ä¸Šé‡‡æ ·è·¯å¾„ (DySample ä¿æŒ mAP) ===
  - [-1, 1, DySample, [2, 'lp']] # 11 (P5 -> P4)
  - [[-1, 6], 1, Concat, [1]] # cat backbone P4
  - [-1, 2, C3k2, [512, False]] # 13 (Head éƒ¨åˆ†å»ºè®®ä¿ç•™ C3k2 ä»¥ç»´æŒèåˆèƒ½åŠ›ï¼Œæˆ–è€…ä¹Ÿæ¢æˆ C2f_Star è¿›ä¸€æ­¥æè‡´è½»é‡åŒ–ï¼Œè¿™é‡Œå…ˆæ±‚ç¨³ä¿ç•™ C3k2)

  - [-1, 1, DySample, [2, 'lp']] # 14 (P4 -> P3)
  - [[-1, 4], 1, Concat, [1]] # cat backbone P3
  - [-1, 2, C3k2, [256, False]] # 16 (æ ‡å‡†çš„ P3 Neck è¾“å‡º - è¯­ä¹‰æµ)

  # === ğŸš€ [åˆ›æ–°ç‚¹ 2] ç»†èŠ‚åˆ†æ”¯ (Detail Branch) ===
  # å›å¤´å»æ‹¿ Layer 1 (P2) çš„é«˜åˆ†è¾¨ç‡ç‰¹å¾
  
  # 17: ScConv æ¸…æ´— P2 ç‰¹å¾ (å»å™ª)
  - [1, 1, ScConv, [128]] 
  
  # 18: HWD ä¸‹é‡‡æ · (P2 -> P3 å°ºåº¦ï¼Œä¿ç•™çº¹ç†)
  - [-1, 1, HWD_Down, [128]] 

  # === ğŸš€ [åˆ›æ–°ç‚¹ 3] é¢‘ç‡é—¨æ§èåˆ (Frequency Gate) ===
  # 19: åŠ¨æ€èåˆ [è¯­ä¹‰æµ(16), ç»†èŠ‚æµ(18)]
  # è¾“å…¥: 256(Sem) + 128(Detail) -> è¾“å‡º: 256
  - [[16, 18], 1, FrequencyGate, [128, 256]] # args: [c_detail, c_out]

  # === å‰©ä¸‹çš„æ£€æµ‹å¤´è·¯å¾„ (æ³¨æ„ Source æŒ‡å‘ 19) ===
  
  # ä¸‹é‡‡æ · P3 -> P4
  - [19, 1, Conv, [256, 3, 2]] 
  - [[-1, 13], 1, Concat, [1]] # cat head P4
  - [-1, 2, C3k2, [512, False]] # 22 (P4/16-medium)

  # ä¸‹é‡‡æ · P4 -> P5
  - [-1, 1, Conv, [512, 3, 2]] 
  - [[-1, 10], 1, Concat, [1]] # cat head P5
  - [-1, 2, C3k2, [1024, True]] # 25 (P5/32-large)

  # Detect (P3 ç”¨çš„æ˜¯èåˆåçš„ 19)
  - [[19, 22, 25], 1, Detect, [nc]]