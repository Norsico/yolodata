# Ultralytics ðŸš€ AGPL-3.0 License - https://ultralytics.com/license

# FaRFA-ADown-YOLO
# --------------------------------------------------------
# æ ¸å¿ƒç­–ç•¥: "æžè‡´è½»é‡ + å¼ºç»†èŠ‚æ„ŸçŸ¥"
# 1. Backbone: å¼•å…¥ ADown æ›¿æ¢æ‰€æœ‰ä¸‹é‡‡æ ·å·ç§¯ã€‚
#    ADown åˆ©ç”¨ AvgPool å’Œ MaxPool é…åˆ 1x1/3x3 å·ç§¯ï¼Œå‚æ•°é‡ä»…ä¸ºæ™®é€šå·ç§¯çš„ ~1/4ã€‚
# 2. Detail Branch: FaRFA (RFAConv + HWD) ä¿æŒä¸å˜ï¼Œé”å®šä¸‰è½®è½¦ç‰¹å¾ã€‚
# 3. Head: Gate èžåˆã€‚
# --------------------------------------------------------

# Parameters
nc: 6 
scales: 
  n: [0.50, 0.25, 1024] 

# Backbone
backbone:
  # Layer 0: Stem å±‚å»ºè®®ä¿ç•™æ™®é€š Convï¼Œä¸ºäº†ä¿ç•™åŽŸå§‹åƒç´ ä¿¡æ¯
  - [-1, 1, Conv, [64, 3, 2]] # 0-P1/2
  
  # ðŸš€ [æ›¿æ¢] Conv -> ADown (P1 -> P2)
  # å‚æ•°é‡å¤§å¹…ä¸‹é™
  - [-1, 1, ADown, [128]] # 1-P2/4 (ç»†èŠ‚æµæºå¤´)
  
  - [-1, 2, C3k2, [256, False, 0.25]]
  
  # ðŸš€ [æ›¿æ¢] Conv -> ADown (P2 -> P3)
  - [-1, 1, ADown, [256]] # 3-P3/8
  
  - [-1, 2, C3k2, [512, False, 0.25]]
  
  # ðŸš€ [æ›¿æ¢] Conv -> ADown (P3 -> P4)
  - [-1, 1, ADown, [512]] # 5-P4/16
  
  - [-1, 2, C3k2, [512, True]]
  
  # ðŸš€ [æ›¿æ¢] Conv -> ADown (P4 -> P5)
  - [-1, 1, ADown, [1024]] # 7-P5/32
  
  - [-1, 2, C3k2, [1024, True]]
  - [-1, 1, SPPF, [1024, 5]] # 9
  - [-1, 2, C2PSA, [1024]] # 10

# Head
head:
  # === DySample ä¸Šé‡‡æ · ===
  - [-1, 1, DySample, [2, 'lp']] # 11
  - [[-1, 6], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 13

  - [-1, 1, DySample, [2, 'lp']] # 14
  - [[-1, 4], 1, Concat, [1]] 
  - [-1, 2, C3k2, [256, False]] # 16 (P3 è¯­ä¹‰æµ)

  # === Detail Branch (FaRFA) ===
  # ä¿æŒä¸åŠ¨ï¼Œè¿™æ˜¯ä½ çš„ mAP æ ¸å¿ƒ
  - [1, 1, RFAConv, [128]] # 17 (RFAConv 128ch)
  - [-1, 1, HWD_Down, [128]] # 18

  # === Frequency Gate ===
  - [[16, 18], 1, FrequencyGate, [128, 256]] # 19

  # === è¾“å‡ºè·¯å¾„ (ä¸‹é‡‡æ ·ä¹Ÿæ¢æˆ ADown) ===
  
  # ðŸš€ [æ›¿æ¢] Conv -> ADown (P3 -> P4)
  - [19, 1, ADown, [256]] # 20 (è¿™é‡Œä¸éœ€è¦ stride å‚æ•°ï¼ŒADown å†…éƒ¨é€»è¾‘å›ºå®š)
  
  - [[-1, 13], 1, Concat, [1]] 
  - [-1, 2, C3k2, [512, False]] # 22

  # ðŸš€ [æ›¿æ¢] Conv -> ADown (P4 -> P5)
  - [-1, 1, ADown, [512]] # 23
  
  - [[-1, 10], 1, Concat, [1]] 
  - [-1, 2, C3k2, [1024, True]] # 25

  - [[19, 22, 25], 1, Detect, [nc]]